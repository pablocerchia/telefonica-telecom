---
title: "FUSIÓN TELECOM Y TELEFÓNICA"
embed-resources: true
format:
  closeread-html:
    remove-header-space: true
    cr-style:
      section-background-color: white
      narrative-background-color-sidebar: "#f1e5f8"
      narrative-background-color-overlay: "rgba(0,0,0,0.6)"
      narrative-text-color-overlay: "white"
      narrative-sidebar-width: 2fr
      narrative-font-size: 24pt
      narrative-font-size-sidebar: 36pt
      narrative-font-size-overlay: 36pt
      narrative-overlay-max-width: 800px
execute:
  warning: false
---

::::{.cr-section}

:::{#cr-headline}
 ![](fondo_compra.jpg){.scale-to-fill}
:::

@cr-headline <span style="font-size: 48pt; font-weight: bold; text-align: center; color: #171a1f; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FUSIÓN <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TELECOM Y TELEFÓNICA</span> 

@cr-headline La empresa del Grupo Clarín desembolsó US$ 1.245 millones para quedarse con Telefónica Argentina. 

@cr-headline La operación marca un hito histórico en el mercado de telecomunicaciones argentino. 

@cr-headline Así se distribuye el Market Share en Argentina previo a la adquisición. @cr-market-plot

:::{#cr-market-plot}
```{ojs}
//| label: market-share-plot-ojs
//| echo: false
//| fig.width: 30
//| fig.height: 12

market_data_ojs_raw = await FileAttachment("nacional.csv").csv({ typed: false });
market_data_ojs = market_data_ojs_raw.map(d => ({
  ...d,
  "Share pre fusion": parseFloat(String(d["Share pre fusion"]).replace('%', '').trim())
}));

viewof chart = Plot.plot({
  title: "",
  marginLeft: 150,
  marginRight: 50,
  height: 700,
  width: 850,
  marks: [
    Plot.barX(market_data_ojs, {
      y: "Grupo ME",
      x: "Share pre fusion",
      fill: "#9F4DD2",
    }),
    Plot.text(market_data_ojs, {
      x: "Share pre fusion",
      y: "Grupo ME",
      text: d => d["Share pre fusion"].toFixed(1) + "%",
      dx: 4,
      fill: "black",
      textAnchor: "start"
    }),
    Plot.ruleX([0])
  ],
  y: {
    label: "Grupo",
    tickLabelAnchor: "start",
    domain: market_data_ojs.sort((a, b) => b["Share pre fusion"] - a["Share pre fusion"]).map(d => d["Grupo ME"]),
    padding: 0.3
  },
  x: {
    label: "Share (%)",
    grid: true
  }
})
```
:::

::::

::::{.cr-section}

Flow y Movistar son de los principales players dentro del mercado @cr-market-plot-highlighted

:::{#cr-market-plot-highlighted}
```{ojs}
//| label: market-share-plot-highlighted
//| echo: false
//| fig.width: 30
//| fig.height: 12

// market_data_ojs is assumed to be available from the previous OJS cell

viewof chart_highlighted = Plot.plot({
  title: "", // Added a slightly different title
  marginLeft: 150,
  marginRight: 50, 
  height: 700,
  width: 850,
  marks: [
    Plot.barX(market_data_ojs, {
      y: "Grupo ME",
      x: "Share pre fusion",
      fill: d => (d["Grupo ME"] === "Flow" || d["Grupo ME"] === "Movistar") ? "#9F4DD2" : "#cccccc" // Conditional fill
    }),
    Plot.text(market_data_ojs, {
      x: "Share pre fusion",
      y: "Grupo ME",
      text: d => d["Share pre fusion"].toFixed(1) + "%",
      dx: 4, 
      fill: d => (d["Grupo ME"] === "Flow" || d["Grupo ME"] === "Movistar") ? "#333333" : "#555555", // Slightly different text fill for highlighted
      textAnchor: "start"
    }),
    Plot.ruleX([0])
  ],
  y: {
    label: "Grupo",
    tickLabelAnchor: "start",
    domain: market_data_ojs.sort((a, b) => b["Share pre fusion"] - a["Share pre fusion"]).map(d => d["Grupo ME"]),
    padding: 0.3
  },
  x: {
    label: "Share (%)",
    grid: true
  }
})
```
:::

::::

::::{.cr-section}

Un detalle más cercano a estos dos competidores: [@cr-market-plot-zoomed]{scale-by="1.2"}

:::{#cr-market-plot-zoomed}
```{ojs}
//| label: market-share-plot-zoomed
//| echo: false
//| fig.width: 30 
//| fig.height: 8 // Adjusted height for fewer bars

// market_data_ojs is assumed to be available from the previous OJS cell
zoomed_data = market_data_ojs.filter(d => d["Grupo ME"] === "Flow" || d["Grupo ME"] === "Movistar");

viewof chart_zoomed = Plot.plot({
  title: "",
  marginLeft: 150,
  marginRight: 50, 
  height: 400, // Adjusted height for fewer bars
  width: 850,
  marks: [
    Plot.barX(zoomed_data, {
      y: "Grupo ME",
      x: "Share pre fusion",
      fill: "#9F4DD2" // Keep highlight color
    }),
    Plot.text(zoomed_data, {
      x: "Share pre fusion",
      y: "Grupo ME",
      text: d => d["Share pre fusion"].toFixed(1) + "%",
      dx: 4, 
      fill: "#333333",
      textAnchor: "start"
    }),
    Plot.ruleX([0])
  ],
  y: {
    label: "Grupo",
    tickLabelAnchor: "start",
    domain: zoomed_data.map(d => d["Grupo ME"]), // Domain is just these two
    padding: 0.5 // More padding for fewer bars
  },
  x: {
    label: "Share (%)",
    grid: true,
    // Optional: Adjust domain to zoom on x-axis if desired, e.g.:
    // domain: [0, Math.max(...zoomed_data.map(d => d["Share pre fusion"])) * 1.1] 
  }
})
```
:::

::::

::::{.cr-section}

:::{#cr-mapa-base-presencia}
```{ojs}
//| echo: false

Plot = require("@observablehq/plot")
d3 = require("d3@7")

mapa_geojson_data = await d3.json("provincias.geojson");

Plot.plot({
  projection: {
    type: "mercator",
    scale: 2200,
    rotate: [63.5, 38, 0]
  },
  marks: [
    Plot.geo(mapa_geojson_data, {
      fill: "lightgray",
      stroke: "white",
      strokeWidth: 0.1,
      tip: true
    })
  ],
  width: 2400,
  height: 2050,
  style: {
    background: "transparent"
  }
})
```
:::

:::{#cr-mapa-activo}
```{ojs}
//| echo: false

provincesToHighlight = [
  "BUENOS AIRES", "CIUDAD AUTONOMA DE BUENOS AIRES", "CHUBUT", "CORDOBA",
  "ENTRE RIOS", "FORMOSA", "LA PAMPA", "MENDOZA", "MISIONES",
  "NEUQUEN", "RIO NEGRO", "SALTA", "SAN JUAN", "TIERRA DEL FUEGO"
];

Plot.plot({
  projection: {
    type: "mercator",
    scale: 2200,
    rotate: [63.5, 38, 0]
  },
  marks: [
    Plot.geo(mapa_geojson_data, {
      fill: "lightgray",
      stroke: "white",
      strokeWidth: 0.1
    }),
    Plot.geo(
      {
        type: "FeatureCollection",
        features: mapa_geojson_data.features.filter(
          d => provincesToHighlight.includes(d.properties.id)
        )
      },
      {
        fill: "#009ef7",
        fillOpacity: 0.8,
        stroke: "black",
        strokeWidth: 0.1
      }
    )
  ],
  width: 1600,
  height: 1400,
  style: {
    background: "transparent"
  }
})
```
:::

:::{#cr-barras-provincias}
```{ojs}
//| echo: false
//| fig.width: 30
//| fig.height: 12

provincia_data = await FileAttachment("PROVINCIA_MOVISTAR.csv").csv({ typed: false });

// Convertir los valores a números y ordenar los datos
provincia_data_processed = provincia_data
  .filter(d => d.Provincia) // Filter out empty rows
  .map(d => ({
    Provincia: d.Provincia,
    "Abonados pre fusion": parseInt(d["Abonados pre fusion"].replace(/,/g, '')) // Remove commas and convert to number
  }))
  .sort((a, b) => b["Abonados pre fusion"] - a["Abonados pre fusion"]);

// Provincias a destacar
provinciasDestacadas = [
  "BUENOS AIRES",
  "CIUDAD AUTONOMA DE BUENOS AIRES",
  "MENDOZA"
];

viewof chart_provincias = Plot.plot({
  title: "",
  marginLeft: 150,
  marginRight: 50,
  height: 700,
  width: 850,
  marks: [
    Plot.barX(provincia_data_processed, {
      y: "Provincia",
      x: "Abonados pre fusion",
      fill: d => provinciasDestacadas.includes(d.Provincia) ? "#009ef7" : "#cccccc",
      fillOpacity: d => provinciasDestacadas.includes(d.Provincia) ? 0.9 : 0.6
    }),
    Plot.text(provincia_data_processed, {
      x: "Abonados pre fusion",
      y: "Provincia",
      text: d => d["Abonados pre fusion"].toString(),
      dx: 4,
      fill: d => provinciasDestacadas.includes(d.Provincia) ? "#333333" : "#555555",
      textAnchor: "start"
    }),
    Plot.ruleX([0])
  ],
  y: {
    label: "Provincia",
    tickLabelAnchor: "start",
    domain: provincia_data_processed.map(d => d.Provincia),
    padding: 0.3
  },
  x: {
    label: "Abonados",
    grid: true
  }
})
```
:::

:::{#cr-mapa-concentracion}
```{ojs}
//| echo: false

concentracionProvincias = [
  "BUENOS AIRES",
  "CIUDAD AUTONOMA DE BUENOS AIRES",
  "MENDOZA"
];

Plot.plot({
  projection: {
    type: "mercator",
    scale: 2200,
    rotate: [63.5, 38, 0]
  },
  marks: [
    Plot.geo(mapa_geojson_data, {
      fill: "lightgray",
      stroke: "white",
      strokeWidth: 0.1,
      tip: true
    }),
    Plot.geo(
      {
        type: "FeatureCollection",
        features: mapa_geojson_data.features.filter(
          d => concentracionProvincias.includes(d.properties.id)
        )
      },
      {
        fill: "#009ef7",
        fillOpacity: 0.9,
        stroke: "black",
        strokeWidth: 0.15,
        tip: true
      }
    )
  ],
  width: 2400,
  height: 2050,
  style: {
    background: "transparent"
  }
})
```
:::

[@cr-mapa-base-presencia]{scale-by="7.4"} ¿Cómo es la presencia de Movistar en el mercado?

[@cr-mapa-activo]{scale-by="7.4"} Según el relevamiento de BB Media, Movistar tiene actualmente presencia en 14 provincias.

[@cr-mapa-concentracion]{scale-by="16.8"} El 81% de sus abonados se concentran en CABA, Buenos Aires y Mendoza.

[@cr-barras-provincias]{scale-by="1.2"} La distribución de abonados muestra una clara concentración en tres provincias principales.

::::

::::{.cr-section}

:::{#cr-mapa-patagonia}
```{ojs}
//| echo: false

// Shared definition for both visualizations
provinciasPatagonia = [
  "RIO NEGRO",
  "CHUBUT",
  "TIERRA DEL FUEGO",
  "NEUQUEN"
];

Plot.plot({
  projection: {
    type: "mercator",
    scale: 3500,
    rotate: [63.5, 38, 0]
  },
  marks: [
    Plot.geo(mapa_geojson_data, {
      fill: "lightgray",
      stroke: "white",
      strokeWidth: 0.1
    }),
    Plot.geo(
      {
        type: "FeatureCollection",
        features: mapa_geojson_data.features.filter(
          d => provinciasPatagonia.includes(d.properties.id)
        )
      },
      {
        fill: "#009ef7",
        fillOpacity: 0.8,
        stroke: "black",
        strokeWidth: 0.15
      }
    )
  ],
  width: 2400,
  height: 2050,
  style: {
    background: "transparent"
  }
})
```
:::

[@cr-mapa-patagonia]{scale-by="7.4"} Las provincias donde Movistar tiene una posición más dominante en el market share es en la Patagonia, con participaciones que van desde el 36% hasta el 45% del mercado.

[@cr-mapa-patagonia]{pan-to="0%,-45%" scale-by="16.4"} Estas son: Río Negro, Chubut, Tierra del Fuego y Neuquén.

:::{#cr-barras-share}
```{ojs}
//| echo: false

provincia_share_data = await FileAttachment("PROVINCIA_MOVISTAR.csv").csv({ typed: false });

// Convertir los valores a números y ordenar los datos
provincia_share_processed = provincia_share_data
  .filter(d => d.Provincia) // Filter out empty rows
  .map(d => ({
    Provincia: d.Provincia,
    "Share pre fusion": parseFloat(d["Share pre fusion"].replace('%', ''))
  }))
  .sort((a, b) => b["Share pre fusion"] - a["Share pre fusion"]);

viewof chart_share = Plot.plot({
  title: "",
  marginLeft: 150,
  marginRight: 50,
  height: 700,
  width: 850,
  marks: [
    Plot.barX(provincia_share_processed, {
      y: "Provincia",
      x: "Share pre fusion",
      fill: d => provinciasPatagonia.includes(d.Provincia) ? "#009ef7" : "#cccccc",
      fillOpacity: d => provinciasPatagonia.includes(d.Provincia) ? 0.9 : 0.6
    }),
    Plot.text(provincia_share_processed, {
      x: "Share pre fusion",
      y: "Provincia",
      text: d => d["Share pre fusion"].toFixed(1) + "%",
      dx: 4,
      fill: d => provinciasPatagonia.includes(d.Provincia) ? "#333333" : "#555555",
      textAnchor: "start"
    }),
    Plot.ruleX([0])
  ],
  y: {
    label: "Provincia",
    tickLabelAnchor: "start",
    domain: provincia_share_processed.map(d => d.Provincia),
    padding: 0.3
  },
  x: {
    label: "Market Share (%)",
    grid: true
  }
})
```
:::

[@cr-barras-share]{scale-by="1.2"} En estas provincias del sur, Movistar alcanza sus mayores niveles de participación de mercado, llegando al 45.6% en Río Negro y 43.6% en Chubut.

::::

::::{.cr-section layout="overlay-center"}


:::{#cr-panorama}

:::

¿Cómo quedaría reconfigurada la presencia de Flow en el mercado? @cr-panorama 

::::

::::{.cr-section}

:::{#cr-logoflow}
![](flow_logo.png){.scale-to-fill}
:::


:::{#cr-mapa-flow}
```{ojs}
//| echo: false

// Shared definition for both visualizations
provinciasFlow = [
"BUENOS AIRES",
"CIUDAD AUTONOMA DE BUENOS AIRES",
"CATAMARCA",
"CHACO",
"CHUBUT",
"CORDOBA",
"CORRIENTES",
"ENTRE RIOS",
"FORMOSA",
"JUJUY",
"LA PAMPA",
"LA RIOJA",
"MENDOZA",
"MISIONES",
"NEUQUEN",
"RIO NEGRO",
"SALTA",
"SAN JUAN",
"SAN LUIS",
"SANTA FE",
"SANTIAGO DEL ESTERO",
"TIERRA DEL FUEGO",
"TUCUMAN"
];

Plot.plot({
  projection: {
    type: "mercator",
    scale: 3500,
    rotate: [63.5, 38, 0]
  },
  marks: [
    Plot.geo(mapa_geojson_data, {
      fill: "lightgray",
      stroke: "white",
      strokeWidth: 0.1
    }),
    Plot.geo(
      {
        type: "FeatureCollection",
        features: mapa_geojson_data.features.filter(
          d => provinciasFlow.includes(d.properties.id)
        )
      },
      {
        fill: "#21dbaa",
        fillOpacity: 0.8,
        stroke: "black",
        strokeWidth: 0.15
      }
    )
  ],
  width: 2400,
  height: 2050,
  style: {
    background: "transparent"
  }
})
```
:::

[@cr-logoflow]{scale-by="0.7"} Actualmente Flow es el líder en el mercado de Internet en Argentina con 3.9 millones de abonados y 34.68% de Market Share.

[@cr-mapa-flow]{scale-by="7.4"} Tiene presencia en 23 provincias

::::

::::{.cr-section}

:::{#cr-mapa-fusion}
```{ojs}
//| echo: false

// Define the provinces for each color group
provinciasVioleta = [
  "BUENOS AIRES",
  "CHACO",
  "CIUDAD AUTONOMA DE BUENOS AIRES",
  "CORDOBA",
  "CORRIENTES",
  "ENTRE RIOS",
  "FORMOSA",
  "LA RIOJA",
  "MISIONES",
  "SALTA",
  "SANTA FE",
  "SANTIAGO DEL ESTERO",
  "TUCUMAN"
];

provinciasVerdes = [
  "CATAMARCA",
  "CHUBUT",
  "JUJUY",
  "LA PAMPA",
  "MENDOZA",
  "NEUQUEN",
  "RIO NEGRO",
  "SAN JUAN",
  "SAN LUIS",
  "TIERRA DEL FUEGO"
];

Plot.plot({
  projection: {
    type: "mercator",
    scale: 2200,
    rotate: [63.5, 38, 0]
  },
  marks: [
    Plot.geo(mapa_geojson_data, {
      fill: d => {
        if (provinciasVioleta.includes(d.properties.id)) return "#8A26C9";
        if (provinciasVerdes.includes(d.properties.id)) return "#21dbaa";
        return "lightgray";  // For SANTA CRUZ and any other provinces
      },
      stroke: "white",
      strokeWidth: 0.1
    })
  ],
  width: 2400,
  height: 2050,
  style: {
    background: "transparent"
  }
})
```
:::

[@cr-mapa-fusion]{scale-by="7.6"} Hoy en día Flow es <span style="color:#8A26C9">**LÍDER DE MERCADO**</span> en 13 de esas provincias.

::::

::::{.cr-section}

:::{#cr-mapa-post-fusion}
```{ojs}
//| echo: false

// Define the provinces for each color group
provinciasPostFusion = [
  "BUENOS AIRES",
  "CHACO",
  "CHUBUT",
  "CIUDAD AUTONOMA DE BUENOS AIRES",
  "CORDOBA",
  "CORRIENTES",
  "ENTRE RIOS",
  "FORMOSA",
  "LA RIOJA",
  "MENDOZA",
  "MISIONES",
  "RIO NEGRO",
  "SALTA",
  "SAN JUAN",
  "SANTA FE",
  "SANTIAGO DEL ESTERO",
  "TUCUMAN"
];

provinciasVerdesPostFusion = [
  "CATAMARCA",
  "JUJUY",
  "LA PAMPA",
  "NEUQUEN",
  "SAN LUIS",
  "TIERRA DEL FUEGO",
  "SANTA CRUZ"
];

Plot.plot({
  projection: {
    type: "mercator",
    scale: 2200,
    rotate: [63.5, 38, 0]
  },
  marks: [
    Plot.geo(mapa_geojson_data, {
      fill: d => {
        if (provinciasPostFusion.includes(d.properties.id)) return "#8A26C9";
        if (provinciasVerdesPostFusion.includes(d.properties.id)) return "#21dbaa";
        return "lightgray";  // For SANTA CRUZ and any other provinces
      },
      stroke: "white",
      strokeWidth: 0.1
    })
  ],
  width: 2400,
  height: 2050,
  style: {
    background: "transparent"
  }
})
```
:::


:::{#cr-barras-comparacion}
```{ojs}
//| echo: false

comparacion_data = await FileAttachment("comparacion_mov_flow.csv").csv({ typed: false });

// Convertir los valores a números y procesar los datos
comparacion_processed = comparacion_data
  .map(d => ({
    Provincia: d.Provincia,
    Grupo: d["Grupo ME"],
    Share: parseFloat(d["Share pre fusion"].replace('%', ''))
  }))
  .sort((a, b) => {
    if (a.Provincia !== b.Provincia) {
      return b.Share - a.Share;
    }
    // Si es la misma provincia, Flow va primero
    return a.Grupo === "Flow" ? -1 : 1;
  });

viewof chart_comparacion = Plot.plot({
  title: "",
  marginLeft: 150,
  marginRight: 50,
  marginBottom: 100,
  height: 700,
  width: 850,
  y: {
    label: "Market Share (%)",
    grid: true
  },
  x: {
    label: "Provincia",
    tickRotate: -45,
    padding: 0.2
  },
  marks: [
    Plot.barY(comparacion_processed, {
      x: "Provincia",
      y: "Share",
      fill: "Grupo",
      title: d => `${d.Grupo}: ${d.Share.toFixed(1)}%`,
      dodge: true,
      order: d => d.Grupo === "Flow" ? 0 : 1  // Asegura que Flow siempre va primero
    })
  ],
  color: {
    domain: ["Flow", "Movistar"],
    range: ["#21dbaa", "#009ef7"],
    legend: true
  }
})
```
:::

:::{#cr-barras-agrupadas}
```{ojs}
//| echo: false

comparacion_data_agrupado = await FileAttachment("comparacion_mov_flow.csv").csv({ typed: false });

// Convertir los valores a números y procesar los datos
comparacion_processed_agrupado = comparacion_data_agrupado
  .map(d => ({
    Provincia: d.Provincia,
    Grupo: d["Grupo ME"],
    Share: parseFloat(d["Share pre fusion"].replace('%', ''))
  }))
  .sort((a, b) => b.Share - a.Share);

viewof chart_agrupado = Plot.plot({
  title: "",
  marginLeft: 150,
  marginRight: 50,
  marginBottom: 100,
  height: 700,
  width: 850,
  y: {
    label: "Market Share (%)",
    grid: true
  },
  x: {
    label: "Provincia",
    tickRotate: -45,
    padding: 0.2
  },
  marks: [
    Plot.barY(comparacion_processed_agrupado, {
      x: "Provincia",
      y: "Share",
      fx: "Grupo",  // <--- esto es lo clave
      fill: "Grupo",
      title: d => `${d.Grupo}: ${d.Share.toFixed(1)}%`
    })
  ],
  color: {
    domain: ["Flow", "Movistar"],
    range: ["#21dbaa", "#009ef7"],
    legend: true
  }
})
```
:::

:::{#cr-barras-flow-post}
```{ojs}
//| echo: false

flow_post_data = await FileAttachment("comparacion_mov_flow.csv").csv({ typed: false });

// Filtrar solo Flow y procesar los datos
flow_post_processed = flow_post_data
  .filter(d => d["Grupo ME"] === "Flow")
  .map(d => ({
    Provincia: d.Provincia,
    Share: parseFloat(d["Share post fusion"].replace('%', ''))
  }))
  .sort((a, b) => b.Share - a.Share);

viewof chart_flow_post = Plot.plot({
  title: "",
  marginLeft: 150,
  marginRight: 50,
  marginBottom: 100,
  height: 700,
  width: 850,
  y: {
    label: "Market Share Post Fusión (%)",
    grid: true
  },
  x: {
    label: "Provincia",
    tickRotate: -45,
    padding: 0.2
  },
  marks: [
    Plot.barY(flow_post_processed, {
      x: "Provincia",
      y: "Share",
      fill: "#21dbaa"
    }),
    Plot.text(flow_post_processed, {
      x: "Provincia",
      y: "Share",
      text: d => d.Share.toFixed(1) + "%",
      dy: -8,
      fontSize: 12
    })
  ]
})
```
:::

[@cr-mapa-post-fusion]{scale-by="7.8"} Tras la fusión, Flow pasará a ser <span style="color:#8A26C9">**LÍDER DE MERCADO**</span> en 17 de esas provincias y tendría cobertura en todas las provincias del país.
 
[@cr-barras-agrupadas]{scale-by="1.2"} Veámos en detalle el impacto de la fusión en el Market Share de Flow.  


[@cr-barras-comparacion]{scale-by="1.3"} Así quedaría el Market Share de Flow en las provincias que comparte cobertura con Movistar.

[@cr-barras-flow-post]{scale-by="1.3"} Así quedaría el Market Share de Flow en las provincias que comparte cobertura con Movistar.

::::

::::{.cr-section}

:::{#cr-nacional-share}
```{ojs}
//| echo: false
//| fig.width: 30
//| fig.height: 12

nacional_data = await FileAttachment("nacional.csv").csv({ typed: false });

// Process the data
nacional_processed = nacional_data
  .filter(d => d["Grupo ME"]) // Filter out empty rows
  .map(d => ({
    Grupo: d["Grupo ME"],
    Share: parseFloat(d["Share pre fusion"].replace('%', '').trim())
  }))
  .sort((a, b) => b.Share - a.Share);

viewof chart_nacional = Plot.plot({
  title: "Market Share Nacional Pre Fusión",
  marginLeft: 150,
  marginRight: 50,
  height: 700,
  width: 850,
  marks: [
    Plot.barX(nacional_processed, {
      y: "Grupo",
      x: "Share",
      fill: d => {
        if (d.Grupo === "Flow") return "#21dbaa";
        if (d.Grupo === "Movistar") return "#009ef7";
        return "#cccccc";
      }
    }),
    Plot.text(nacional_processed, {
      x: "Share",
      y: "Grupo",
      text: d => d.Share.toFixed(1) + "%",
      dx: 4,
      fill: "black",
      textAnchor: "start"
    }),
    Plot.ruleX([0])
  ],
  y: {
    label: "Grupo",
    tickLabelAnchor: "start",
    domain: nacional_processed.map(d => d.Grupo),
    padding: 0.3
  },
  x: {
    label: "Market Share (%)",
    grid: true
  }
})
```
:::

[@cr-nacional-share]{scale-by="1.2"} A nivel nacional, Flow lidera el mercado con un 34.7% de participación, seguido por otros operadores con 18.9%. Movistar, que será adquirida por Flow, actualmente tiene un 12.9% del mercado.

:::{#cr-nacional-share-post}
```{ojs}
//| echo: false
//| fig.width: 30
//| fig.height: 12

nacional_data_post = await FileAttachment("nacional.csv").csv({ typed: false });

// Process the data for post fusion
nacional_processed_post = nacional_data_post
  .filter(d => d["Grupo ME"] && parseFloat(d["Share post fusion"].replace('%', '').trim()) > 0) // Filter out Movistar and empty rows
  .map(d => ({
    Grupo: d["Grupo ME"],
    Share: parseFloat(d["Share post fusion"].replace('%', '').trim())
  }))
  .sort((a, b) => b.Share - a.Share);

viewof chart_nacional_post = Plot.plot({
  title: "Market Share Nacional Post Fusión",
  marginLeft: 150,
  marginRight: 50,
  height: 700,
  width: 850,
  marks: [
    Plot.barX(nacional_processed_post, {
      y: "Grupo",
      x: "Share",
      fill: d => d.Grupo === "Flow" ? "#21dbaa" : "#cccccc"
    }),
    Plot.text(nacional_processed_post, {
      x: "Share",
      y: "Grupo",
      text: d => d.Share.toFixed(1) + "%",
      dx: 4,
      fill: "black",
      textAnchor: "start"
    }),
    Plot.ruleX([0])
  ],
  y: {
    label: "Grupo",
    tickLabelAnchor: "start",
    domain: nacional_processed_post.map(d => d.Grupo),
    padding: 0.3
  },
  x: {
    label: "Market Share (%)",
    grid: true
  }
})
```
:::

[@cr-nacional-share-post]{scale-by="1.2"} Tras la fusión, Flow alcanzará un 47.5% del mercado nacional, consolidándose como el líder indiscutido del sector. El siguiente competidor más cercano mantendrá un 18.9% de participación.

::::